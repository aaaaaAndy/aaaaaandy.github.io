<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-nginx/Nginx常用配置">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Nginx常用配置 | aaaaaandy.github.io</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aaaaaAndy.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aaaaaAndy.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aaaaaAndy.github.io/docs/nginx/Nginx常用配置"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Nginx常用配置 | aaaaaandy.github.io"><meta data-rh="true" name="description" content="📆57:12"><meta data-rh="true" property="og:description" content="📆57:12"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aaaaaAndy.github.io/docs/nginx/Nginx常用配置"><link data-rh="true" rel="alternate" href="https://aaaaaAndy.github.io/docs/nginx/Nginx常用配置" hreflang="en"><link data-rh="true" rel="alternate" href="https://aaaaaAndy.github.io/docs/nginx/Nginx常用配置" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="aaaaaandy.github.io RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="aaaaaandy.github.io Atom Feed"><link rel="stylesheet" href="/assets/css/styles.008d67db.css">
<link rel="preload" href="/assets/js/runtime~main.ffc5e5a1.js" as="script">
<link rel="preload" href="/assets/js/main.8fee9b7a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="aaaaaAndy" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="aaaaaAndy" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">aaaaaAndy</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nginx">Nginx基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/nginx/Nginx常用配置">Nginx常用配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/nginx/Nginx配置文件解析">Nginx配置文件解析</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Nginx常用配置</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx常用配置</h1></header><p>📆: 2023-03-27 07:57:12
🏷: #nginx </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一常用配置">一、常用配置<a href="#一常用配置" class="hash-link" aria-label="Direct link to 一、常用配置" title="Direct link to 一、常用配置">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-gzip压缩">1. gzip压缩<a href="#1-gzip压缩" class="hash-link" aria-label="Direct link to 1. gzip压缩" title="Direct link to 1. gzip压缩">​</a></h3><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include          mime.conf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_type     application/octet-stream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip             on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_min_length  1k;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_comp_level  5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gzip_types       text/plain text/css application/x-javascript application/javascript text/javascript;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部分参数含义：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>gzip_min_length</td><td>正整数，单位为字节，也可用k表示千字节，比如写成1024与1k都可以，效果是一样的，表示当资源大于1k时才进行压缩，资源大小取响应头中的Content-Length进行比较，经测试如果响应头不存在Content_length信息，该限制参数对于这个响应包是不起作用的；另外此处参数值不建议设的太小，因为设的太小，一些本来很小的文件经过压缩后反而变大了，官网没有给出建议值，在此建议1k起，因为小于1k的也没必要压缩，并根据实际情况来调整设定。</td></tr><tr><td>gzip_comp_level</td><td>1-9的正整数，1最低，压缩时间短，9最高，压缩时间长，吃cpu，但是压缩效果好，实质是用cpu换流量，视情况而用。</td></tr><tr><td>gzip_types</td><td>响应报文数据格式，或者说类型，对应http响应头中的Content-type字段，如常见的有text/html、text/css、application/json、application/javaScript等。用于指定要压缩的响应报文类型。”*”表示压缩所有格式的响应报文，多种格式用空格隔开。如text/html text/css。————————————————</td></tr><tr><td>gzip_http_version</td><td>默认为1.1，此处只能是1.0，或者1.1。设置压缩响应所需的最小http协议版本。</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-配置https">2. 配置https<a href="#2-配置https" class="hash-link" aria-label="Direct link to 2. 配置https" title="Direct link to 2. 配置https">​</a></h3><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  127.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 以下是支持https的配置，其中pem和key证书文件需要去CA机构申请，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 申请后会获得这两个文件，将这两个放在服务器指定目录，如此配置能访问到即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate      /etc/nginx/ssl_certs/draw.lyan.me.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key  /etc/nginx/ssl_certs/draw.lyan.me.key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_timeout  5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_prefer_server_ciphers  on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-允许跨域访问">3. 允许跨域访问<a href="#3-允许跨域访问" class="hash-link" aria-label="Direct link to 3. 允许跨域访问" title="Direct link to 3. 允许跨域访问">​</a></h3><p>可将下面配置添加到指定<code>location</code>中或者<code>server</code>中。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># *表示允许所有站跨域访问（不安全，建议指定具体允许的域名如：http://b.domain.com:9000（注意格式：http(s):// + domain + port，末尾也不能加/）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_header Access-Control-Allow-Origin *;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#此项为允许带cookie跨域访问，若设置true，上面域名配置不能为*，必须指定具体域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_header Access-Control-Allow-Credentials true;  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-iframe同源策略限制">4. iframe同源策略限制<a href="#4-iframe同源策略限制" class="hash-link" aria-label="Direct link to 4. iframe同源策略限制" title="Direct link to 4. iframe同源策略限制">​</a></h3><p>限制iframe插入，可设置为非同源不插入，指定origin插入，默认为不限制</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 限制为同源可用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_header X-Frame-Options SAMEORIGIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定网站可用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_header X-Frame-Options &quot;ALLOW-FROM http://xxx.com:8000&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_header Content-Security-Policy &quot;frame-ancestors http://xxx.com:8000&quot;; # 兼容chrome</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-标准root页面配置">5. 标准root页面配置<a href="#5-标准root页面配置" class="hash-link" aria-label="Direct link to 5. 标准root页面配置" title="Direct link to 5. 标准root页面配置">​</a></h3><p>一般用在官网等能直接通过域名就打开的项目，不需要添加其他的location配置，只匹配根路径，如以下项目可直接通过<code>http://www.xxx.com</code>访问。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  www.xxx.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root   /app/xxx;  # 项目所在目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try_files  $uri $uri/ /index.html;  # vue单页应用需要路由始终指向index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-根据路径访问不同前端静态页面项目">6. 根据路径访问不同前端静态页面项目<a href="#6-根据路径访问不同前端静态页面项目" class="hash-link" aria-label="Direct link to 6. 根据路径访问不同前端静态页面项目" title="Direct link to 6. 根据路径访问不同前端静态页面项目">​</a></h3><p>匹配特殊路径，用在当前域名下有多个项目，需要通过路径来区分访问的情况，如以下配置则需要通过<code>http://www.xxx.com/app-h5</code>才能访问。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  www.xxx.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /app-h5 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              try_files $uri $uri/ /app-h5/index.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              alias /usr/share/nginx/html/h5/mobile/app-h5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              index index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-接口反向代理">7. 接口反向代理<a href="#7-接口反向代理" class="hash-link" aria-label="Direct link to 7. 接口反向代理" title="Direct link to 7. 接口反向代理">​</a></h3><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location /app-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass   http://b.domain.com:9000;  # 相对路径，最终地址会加上/app-api，变成 /app-api/xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # proxy_pass   http://b.domain.com:9000/;  # 绝对地址，最终地址会舍弃/app-api，变成 /xxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # proxy_cookie_domain   b.domain.com a.domain.com; # 需要修改接口返回的cookie域名时使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-upstream负载均衡">8. upstream负载均衡<a href="#8-upstream负载均衡" class="hash-link" aria-label="Direct link to 8. upstream负载均衡" title="Direct link to 8. upstream负载均衡">​</a></h3><aside>💡 upstream 用来配置负载均衡，需要注意的是 upstream 不能配置在 server 块内，即不能跟 location 在同一级别，需要配置在 http 块内，server 块外，否则会报错。</aside><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 默认轮询配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  127.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /app-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass   http://appServer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>六大负载均衡调度策略配置</li></ul><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 加权轮询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 weight=20; # 该服务器收到的连接数占2/3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ip_hash，不可给服务器加权重</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_hash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># url_hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hash $request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># fair(第三方)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fair;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># least_conn，最少连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    least_conn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>调度算法</th><th>概述</th></tr></thead><tbody><tr><td>轮询</td><td>逐一轮询，默认算法</td></tr><tr><td>weight轮询</td><td>加权轮询，weight越大，轮询到的几率越大</td></tr><tr><td>fair</td><td>根据后端服务器的响应时间来分配，响应时间短的优先分配</td></tr><tr><td>ip_hash</td><td>根据ip的hash结果进行分配，来自同一客户端的请求可以打在同一台机器上，能解决后台session不共享的问题</td></tr><tr><td>url_hash</td><td>根据访问的url进行hash分配</td></tr><tr><td>least_conn</td><td>最小连接数，哪个服务器连接数少分配给哪个服务器</td></tr><tr><td>hash关键数值</td><td>hash自定义key</td></tr></tbody></table><ul><li>nginx负载均衡配置状态</li></ul><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 加权轮询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 weight=20; # 该服务器收到的连接数占2/3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># max_fails  fail_timeout，允许请求失败次数和失败之后等待时间，两个必须同时配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 一下配置代表80的服务器允许失败3次，超过3次后，在15秒内请求将不再发送给该服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10 max_fails=3 fail_timeout=15;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 weight=20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># backup 备份机，所有服务挂了之后才会生效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 weight=20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.82:5000 backup;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># down 标识一台服务器不可用，貌似没啥用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 weight=20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 10.0.0.81:5000 down;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># max_conn 最大连接数，超过这个连接数量，将不会分配新的连接给它，默认为0，没有限制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream appServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.80:5000 weight=10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 10.0.0.81:5000 max_conn=1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>状态</th><th>概述</th></tr></thead><tbody><tr><td>down</td><td>当前的server暂不参与负载均衡</td></tr><tr><td>backup</td><td>预留的备份服务器，当其他服务器都挂了的时候启用</td></tr><tr><td>max_fails</td><td>允许请求失败的次数 ，如果请求失败次数超过限制，则进过fail_timeout 时间后从虚拟服务池中kill掉该服务器</td></tr><tr><td>fail_timeout</td><td>经过max_fails失败后，服务暂停时间，max_fails设置后，必须设置fail_timeout 值</td></tr><tr><td>max_conn</td><td>限制最大的连接数，用于服务器硬件配置不同的情况下</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-配置长连接">9. 配置长连接<a href="#9-配置长连接" class="hash-link" aria-label="Direct link to 9. 配置长连接" title="Direct link to 9. 配置长连接">​</a></h3><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 需要注意的是，以下实现的是一个维持90秒的长连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果想实现一个永久不断的链接，有两种方案：一是直连后端服务，不经过nginx；二是用下面的配置，同时要实现一个90秒以内的心跳，保证连接不断开</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keepalive_timeout  90s 90s; # 此两个参数主要实现从客户端到nginx的长连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keepalive_requests 10000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  www.xxx.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client_max_body_size    100m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstream  BACKEND {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      server   192.168.0.1：8080  weight=1 max_fails=2 fail_timeout=30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server   192.168.0.2：8080  weight=1 max_fails=2 fail_timeout=30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      keepalive 300;        // 这个很重要！</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      root   /app/xxx;  # 项目所在目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      try_files  $uri $uri/ /index.html;  # vue单页应用需要路由始终指向index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /mqtt {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_pass http://BACKEND;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_http_version 1.1;  # 此处两个参数实现nginx到后端的长连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_set_header Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_set_header Connection &quot;upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_read_timeout 90;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_send_timeout 90;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_connect_timeout 90;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-限制ip访问">10. 限制ip访问<a href="#10-限制ip访问" class="hash-link" aria-label="Direct link to 10. 限制ip访问" title="Direct link to 10. 限制ip访问">​</a></h3><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#限制IP访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deny 192.168.0.2；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allow 192.168.0.0/24;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allow 192.168.1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deny all;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-配置移动端访问">11. 配置移动端访问<a href="#11-配置移动端访问" class="hash-link" aria-label="Direct link to 11. 配置移动端访问" title="Direct link to 11. 配置移动端访问">​</a></h3><p>此配置可以用来做不同端的自适应，即通过<code>$http_user_agent</code>判断设备类型，返回不同的文件，或者重定向到不同的网址。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 放在server里</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($http_user_agent !~* (mobile|nokia|iphone|ipad|android|samsung|htc|blackberry)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rewrite  ^(.*)    http://www.abc.com$1 permanent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-配置文件服务器">12. 配置文件服务器<a href="#12-配置文件服务器" class="hash-link" aria-label="Direct link to 12. 配置文件服务器" title="Direct link to 12. 配置文件服务器">​</a></h3><p>所谓文件服务器就是通过浏览器可以直接打开服务器的文件，点击可以直接下载，这样就不用专门写下载的页面，简单明了。</p><div class="language-nginx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-nginx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 需要注意的是配置文件需要以root用户启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user root root;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置目录树页面url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location /download {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alias /home/download/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoindex on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoindex_exact_size off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoindex_localtime on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        charset utf-8,gbk;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改头部字段Content-Disposition，直接打开下载框</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location ~ ^/home/download(.*)$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add_header Content-Disposition &quot;attachment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filename=$1&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二具体参数含义">二、具体参数含义<a href="#二具体参数含义" class="hash-link" aria-label="Direct link to 二、具体参数含义" title="Direct link to 二、具体参数含义">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="location路径匹配">location路径匹配<a href="#location路径匹配" class="hash-link" aria-label="Direct link to location路径匹配" title="Direct link to location路径匹配">​</a></h3><table><thead><tr><th>开头</th><th>功能</th></tr></thead><tbody><tr><td>以 = 开头</td><td>表示精确匹配；如只匹配根目录结尾的请求，后面不能带任何字符串</td></tr><tr><td>以 ~ 开头</td><td>表示区分大小写的正则匹配</td></tr><tr><td>以 ~* 开头</td><td>表示不区分大小写的正则匹配</td></tr><tr><td>以 ^~ 开头</td><td>表示uri以某个常规字符串开头，不是正则匹配</td></tr><tr><td>以 / 开头</td><td>通用匹配, 如果没有其它匹配,任何请求都会匹配到</td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/nginx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Nginx基础</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/nginx/Nginx配置文件解析"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Nginx配置文件解析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一常用配置" class="table-of-contents__link toc-highlight">一、常用配置</a><ul><li><a href="#1-gzip压缩" class="table-of-contents__link toc-highlight">1. gzip压缩</a></li><li><a href="#2-配置https" class="table-of-contents__link toc-highlight">2. 配置https</a></li><li><a href="#3-允许跨域访问" class="table-of-contents__link toc-highlight">3. 允许跨域访问</a></li><li><a href="#4-iframe同源策略限制" class="table-of-contents__link toc-highlight">4. iframe同源策略限制</a></li><li><a href="#5-标准root页面配置" class="table-of-contents__link toc-highlight">5. 标准root页面配置</a></li><li><a href="#6-根据路径访问不同前端静态页面项目" class="table-of-contents__link toc-highlight">6. 根据路径访问不同前端静态页面项目</a></li><li><a href="#7-接口反向代理" class="table-of-contents__link toc-highlight">7. 接口反向代理</a></li><li><a href="#8-upstream负载均衡" class="table-of-contents__link toc-highlight">8. upstream负载均衡</a></li><li><a href="#9-配置长连接" class="table-of-contents__link toc-highlight">9. 配置长连接</a></li><li><a href="#10-限制ip访问" class="table-of-contents__link toc-highlight">10. 限制ip访问</a></li><li><a href="#11-配置移动端访问" class="table-of-contents__link toc-highlight">11. 配置移动端访问</a></li><li><a href="#12-配置文件服务器" class="table-of-contents__link toc-highlight">12. 配置文件服务器</a></li></ul></li><li><a href="#二具体参数含义" class="table-of-contents__link toc-highlight">二、具体参数含义</a><ul><li><a href="#location路径匹配" class="table-of-contents__link toc-highlight">location路径匹配</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.ffc5e5a1.js"></script>
<script src="/assets/js/main.8fee9b7a.js"></script>
</body>
</html>