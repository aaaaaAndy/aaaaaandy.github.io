---
tags:
  - ç›¸ç­‰æ€§
---

ES2015 ä¸­æœ‰å››ç§ç›¸ç­‰ç®—æ³•ï¼š

- **_æŠ½è±¡ï¼ˆéä¸¥æ ¼ï¼‰ç›¸ç­‰æ¯”è¾ƒ_** (`==`)
- **_ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ_** (`===`): ç”¨äº Â `Array.prototype.indexOf`,Â `Array.prototype.lastIndexOf`, å’Œ Â `case`matching
- **_åŒå€¼é›¶_**ï¼šç”¨äº Â `%TypedArray%`Â  å’Œ Â `ArrayBuffer`Â  æ„é€ å‡½æ•°ã€ä»¥åŠ`Map`å’Œ`Set`æ“ä½œï¼Œå¹¶å°†ç”¨äº ES2016/ES7 ä¸­çš„`String.prototype.includes`
- **_åŒå€¼_**ï¼šç”¨äºæ‰€æœ‰å…¶ä»–åœ°æ–¹

JavaScript æä¾›ä¸‰ç§ä¸åŒçš„å€¼æ¯”è¾ƒæ“ä½œï¼š

- ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ (ä¹Ÿè¢«ç§°ä½œ"strict equality", "identity", "triple equals")ï¼Œä½¿ç”¨ Â [===Â (en-US)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators#identity)Â ,
- æŠ½è±¡ç›¸ç­‰æ¯”è¾ƒ ("loose equality"ï¼Œ"double equals") ï¼Œä½¿ç”¨ Â [==Â (en-US)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators#equality)
- ä»¥åŠ Â `[Object.is](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is)`Â ï¼ˆECMAScript 2015/ ES6 æ–°ç‰¹æ€§ï¼‰

## ä¸€ã€éä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ

éä¸¥æ ¼ç›¸ç­‰ä½¿ç”¨ä¸¤ä¸ªç­‰å·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„åŒç­‰ï¼Œéä¸¥æ ¼ç›¸ç­‰è¡¨ç¤º**è¯­ä¹‰ç›¸ç­‰**ï¼Œä¸è¦æ±‚ç±»å‹ä¸€æ ·ï¼Œéä¸¥æ ¼ç›¸ç­‰åœ¨æ¯”è¾ƒå‰ä¼šå…ˆå°†æ¯”è¾ƒå‚æ•°ç±»å‹è½¬æ¢ä¸ºä¸€è‡´ï¼Œå†è¿›è¡Œæ¯”è¾ƒï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```javascript
console.log([10] == 10); //true
console.log('10' == 10); //true
console.log([] == 0); //true
console.log(true == 1); //true
console.log([] == false); //true
console.log(![] == false); //true
console.log('' == 0); //true
console.log('' == false); //true
console.log(null == false); //false
console.log(!null == true); //true
console.log(null == undefined); //true

console.log(012 == 12); // false
console.log(012 == 10); // true
console.log(099 == 99); // true è¿™ç§æƒ…å†µæ˜¯å› ä¸ºå…«è¿›åˆ¶ä¸­ä¸å¯èƒ½å‡ºç°9ï¼Œæ‰€ä»¥çœ‹æˆä¸€ä¸ªåè¿›åˆ¶
console.log(09 == 9); // true åŒä¸Š
```

éä¸¥æ ¼ç›¸ç­‰çš„çš„è½¬æ¢é€»è¾‘ï¼Œå¯ä»¥æ€»ç»“ä¸ºå¦‚ä¸‹å‡ æ¡è§„åˆ™ï¼š

- å’Œ `Number` æ¯”è¾ƒæ—¶ï¼Œå¦ä¸€ä¸ªå€¼ä¼šè‡ªåŠ¨è½¬æ¢ä¸º `Number`
- å’Œ `Boolean` æ¯”è¾ƒæ—¶ï¼Œå¦ä¸€ä¸ªå€¼ä¼šè½¬æ¢ä¸º `Number`
- ç®€å•ç±»å‹ä¸å¼•ç”¨ç±»å‹æ¯”è¾ƒï¼Œå¯¹è±¡è½¬åŒ–æˆå…¶åŸå§‹ç±»å‹çš„å€¼ï¼Œå†æ¯”è¾ƒ
- ä¸¤ä¸ªéƒ½ä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆ™æ¯”è¾ƒå®ƒä»¬æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
- `undefined` åªå’Œ `null` ç›¸ç­‰
- å­˜åœ¨ `NaN` åˆ™è¿”å› `false`
- `+0` ç­‰äº `-0`

> - å¦‚æœ Type(x)å’Œ Type(y)ç›¸åŒï¼Œè¿”å› x\=\=\=y b çš„ç»“æœ
> - å¦‚æœ Type(x)å’Œ Type(y)ä¸åŒ

    -   å¦‚æœ x æ˜¯ nullï¼Œy æ˜¯ undefinedï¼Œè¿”å› true
    -   å¦‚æœ x æ˜¯ undefinedï¼Œy æ˜¯ nullï¼Œè¿”å› true
    -   å¦‚æœ Type(x)æ˜¯ Numberï¼ŒType(y)æ˜¯ Stringï¼Œè¿”å› x\==ToNumber(y) çš„ç»“æœ
    -   å¦‚æœ Type(x)æ˜¯ Stringï¼ŒType(y)æ˜¯ Numberï¼Œè¿”å› ToNumber(x)\==y çš„ç»“æœ
    -   å¦‚æœ Type(x)æ˜¯ Booleanï¼Œè¿”å› ToNumber(x)\==y çš„ç»“æœ
    -   å¦‚æœ Type(y)æ˜¯ Booleanï¼Œè¿”å› x\==ToNumber(y) çš„ç»“æœ
    -   å¦‚æœ Type(x)æ˜¯ String æˆ– Number æˆ– Symbol ä¸­çš„ä¸€ç§å¹¶ä¸” Type(y)æ˜¯ Objectï¼Œè¿”å› x\==ToPrimitive(y) çš„ç»“æœ
    -   å¦‚æœ Type(x)æ˜¯ Object å¹¶ä¸” Type(y)æ˜¯ String æˆ– Number æˆ– Symbol ä¸­çš„ä¸€ç§ï¼Œè¿”å› ToPrimitive(x)\==y çš„ç»“æœ
    -   å…¶ä»–è¿”å› false

éä¸¥æ ¼ç›¸ç­‰æœ‰éå¸¸å¤æ‚çš„è½¬æ¢è§„åˆ™ï¼Œéå¸¸éš¾ä»¥è®°å¿†ï¼Œç¤¾åŒºä¸­[æœ‰äºº](https://dorey.github.io/JavaScript-Equality-Table/)å°†ä¸Šé¢çš„è§„åˆ™æ€»ç»“æˆäº†å›¾ç‰‡ï¼Œä¸€å›¾èƒœåƒè¨€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ![591.png](https://raw.githubusercontent.com/aaaaaAndy/picture/main/images/20230406101359.png)

```javascript
a = 1;
```

éä¸¥æ ¼ç›¸ç­‰å¹¶éå¸¦æ¥äº†å¾ˆå¤šä¾¿åˆ©ï¼Œé€šè¿‡éšå¼çš„è‡ªåŠ¨è½¬æ¢ï¼Œç®€åŒ–äº†éƒ¨åˆ†åœºæ™¯çš„å·¥ä½œï¼Œæ¯”å¦‚ Number å’Œ String çš„è‡ªåŠ¨è½¬æ¢ï¼Œç®€åŒ–äº†å‰ç«¯ä»è¡¨å•ï¼Œurl å‚æ•°ä¸­è·å–å€¼çš„æ¯”è¾ƒé—®é¢˜ï¼Œä½†è‡ªåŠ¨è½¬æ¢å¸¦æ¥çš„é—®é¢˜æ¯”ä¾¿åˆ©è¿˜å¤šã€‚

## äºŒã€ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ

ä¸¥æ ¼ç›¸ç­‰æ˜¯å¦ä¸€ç§æ¯”è¾ƒç®—æ³•ï¼Œå…¶å’Œéä¸¥æ ¼æƒ³ç­‰çš„åŒºåˆ«æ˜¯ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œç±»å‹ä¸ä¸€è‡´æ—¶ç›´æ¥è¿”å› falseï¼Œä¸¥æ ¼ç›¸ç­‰å¯¹åº”`===`æ“ä½œç¬¦ï¼Œå› ä¸ºä½¿ç”¨ä¸‰ä¸ªç­‰å·ï¼Œä¹Ÿè¢«ç§°ä½œä¸‰ç­‰æˆ–è€…å…¨ç­‰ï¼Œä¸¥æ ¼ç›¸ç­‰ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
let result1 = '55' === 55; // falseï¼Œä¸ç›¸ç­‰ï¼Œå› ä¸ºæ•°æ®ç±»å‹ä¸åŒ
let result2 = 55 === 55; // trueï¼Œç›¸ç­‰ï¼Œå› ä¸ºæ•°æ®ç±»å‹ç›¸åŒå€¼ä¹Ÿç›¸åŒ
```

`undefined` å’Œ `null` ä¸è‡ªèº«ä¸¥æ ¼ç›¸ç­‰

```jsx
let result1 = null === null; // true
let result2 = undefined === undefined; // true
let result3 = null === undefined; // false ç±»å‹ä¸åŒ
```

ä¸åŒç±»å‹å€¼åˆ¤æ–­è§„åˆ™å¦‚ä¸‹ï¼Œå’Œå‰é¢çš„éä¸¥æ ¼ç›¸ç­‰å¯¹æ¯”ï¼Œä¸¥æ ¼ç›¸ç­‰æ›´ç¬¦åˆç›´è§‰ã€‚

> - å¦‚æœ Type(x)å’Œ Type(y)ä¸åŒï¼Œè¿”å› false
> - å¦‚æœ Type(x)å’Œ Type(y)ç›¸åŒ

    -   å¦‚æœ Type(x)æ˜¯ Undefinedï¼Œè¿”å› true
    -   å¦‚æœ Type(x)æ˜¯ Nullï¼Œè¿”å› true
    -   å¦‚æœ Type(x)æ˜¯ Stringï¼Œå½“ä¸”ä»…å½“ x,y å­—ç¬¦åºåˆ—å®Œå…¨ç›¸åŒï¼ˆé•¿åº¦ç›¸åŒï¼Œæ¯ä¸ªä½ç½®ä¸Šçš„å­—ç¬¦ä¹Ÿç›¸åŒï¼‰æ—¶è¿”å› trueï¼Œå¦åˆ™è¿”å› false
    -   å¦‚æœ Type(x)æ˜¯ Booleanï¼Œå¦‚æœ x,y éƒ½æ˜¯ true æˆ– x,y éƒ½æ˜¯ false è¿”å› trueï¼Œå¦åˆ™è¿”å› false
    -   å¦‚æœ Type(x)æ˜¯ Symbolï¼Œå¦‚æœ x,y æ˜¯ç›¸åŒçš„ Symbol å€¼ï¼Œè¿”å› true,å¦åˆ™è¿”å› false
    -   å¦‚æœ Type(x)æ˜¯ Number ç±»å‹
        -   å¦‚æœ x æ˜¯ NaNï¼Œè¿”å› false
        -   å¦‚æœ y æ˜¯ NaNï¼Œè¿”å› false
        -   å¦‚æœ x çš„æ•°å­—å€¼å’Œ y ç›¸ç­‰ï¼Œè¿”å› true
        -   å¦‚æœ x æ˜¯+0ï¼Œy æ˜¯-0ï¼Œè¿”å› true
        -   å¦‚æœ x æ˜¯-0ï¼Œy æ˜¯+0ï¼Œè¿”å› true
        -   å…¶ä»–è¿”å› false

![592.png](https://raw.githubusercontent.com/aaaaaAndy/picture/main/images/20230406101446.png)

ä¸¥æ ¼ç›¸ç­‰è§£å†³äº†éä¸¥æ ¼ç›¸ç­‰ä¸­éšå¼è½¬æ¢å¸¦æ¥çš„é—®é¢˜ï¼Œä½†ä¹Ÿä¸¢å¤±äº†éšå¼è½¬æ¢å¸¦æ¥çš„ä¾¿åˆ©ï¼Œå¯¹äºç±»å‹å¯èƒ½ä¸ä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä»è¡¨å•ä¸­è·å–çš„å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¿é™©çš„åšæ³•æ˜¯ï¼Œåœ¨æ¯”è¾ƒå‰æ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
1 === Number('1'); // true æ‰‹åŠ¨ç±»å‹è½¬æ¢ï¼Œç±»å‹é˜²å¾¡
```

ä¸¥æ ¼ç›¸ç­‰å‡ ä¹æ€»æ˜¯æ­£ç¡®çš„ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–æƒ…å†µï¼Œæ¯”å¦‚ NaN å’Œæ­£è´Ÿ 0 çš„é—®é¢˜ã€‚

åœ¨ä¸¥æ ¼ç›¸ç­‰ä¸­ï¼ŒNaN æ˜¯ä¸ç­‰äºè‡ªå·±çš„ï¼ŒNaN æ˜¯(x !== x) æˆç«‹çš„å”¯ä¸€æƒ…å†µï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å…¶å®æ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ¤æ–­ NaN çš„ï¼Œå¯ä»¥ä½¿ç”¨ isNaN è¿›è¡Œåˆ¤æ–­ï¼ŒECMAScript 2015 å¼•å…¥äº†æ–°çš„ Number.isNaNï¼Œå’Œ isNaN çš„åŒºåˆ«æ˜¯ä¸ä¼šå¯¹ä¼ å…¥çš„å‚æ•°åšç±»å‹è½¬æ¢ï¼Œå»ºè®®ä½¿ç”¨è¯­ä¹‰æ›´æ¸…æ™°çš„ Number.isNaNï¼Œä½†æ˜¯è¦æ³¨æ„å…¼å®¹æ€§é—®é¢˜ï¼Œåˆ¤æ–­ NaN ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
NaN === NaN; // false

isNaN(NaN); // true
Number.isNaN(NaN); // true

isNaN('aaa'); // true è‡ªåŠ¨è½¬æ¢ç±»å‹ 'aaa'è½¬æ¢ä¸ºNumberä¸ºNaN
Number.isNaN('aaa'); // false ä¸è¿›è¡Œè½¬æ¢ï¼Œç±»å‹ä¸ä¸ºNumberï¼Œç›´æ¥è¿”å›false
```

ä¸¥æ ¼ç›¸ç­‰å¦ä¸€ä¸ªä¾‹å¤–æƒ…å†µæ˜¯ï¼Œæ— æ³•åŒºåˆ†+0 å’Œ-0ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼Œåœ¨ä¸€äº›æ•°å­¦è®¡ç®—åœºæ™¯ä¸­æ˜¯è¦åŒºåˆ†è¯­ä¹‰çš„ã€‚

```jsx
**+**0 **===** **-**0; *// true*
```

JavaScript ä¸­å¾ˆå¤šç³»ç»Ÿå‡½æ•°éƒ½ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰ï¼Œæ¯”å¦‚æ•°ç»„çš„ indexOfï¼ŒlastIndexOf å’Œ switch-case ç­‰ï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™äº›å¯¹äº NaN æ— æ³•è¿”å›æ­£ç¡®ç»“æœï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
[NaN].indexOf(NaN); // -1 æ•°ç»„ä¸­å…¶å®å­˜åœ¨NaN
[NaN].lastIndexOf(NaN); // -1
```

## ä¸‰ã€åŒå€¼é›¶

åŒå€¼é›¶æ˜¯å¦ä¸€ç§ç›¸ç­‰ç®—æ³•ï¼Œåå­—æ¥æºäºè§„èŒƒçš„ç›´è¯‘ï¼Œè§„èŒƒä¸­å«åš SameValueZeroï¼ŒåŒå€¼é›¶å’Œä¸¥æ ¼ç›¸ç­‰åŠŸèƒ½ä¸€æ ·ï¼Œé™¤äº†å¤„ç† NaN çš„æ–¹å¼ï¼ŒåŒå€¼é›¶è®¤ä¸º NaN å’Œ NaN ç›¸ç­‰ï¼Œè¿™åœ¨åˆ¤æ–­ NaN æ˜¯å¦åœ¨é›†åˆä¸­çš„è¯­ä¹‰ä¸‹æ˜¯éå¸¸åˆç†çš„ã€‚ ECMAScript 2016 å¼•å…¥çš„ includes ä½¿ç”¨æ­¤ç®—æ³•ï¼Œæ­¤å¤– Map çš„é”®å»é‡å’Œ Set çš„å€¼å»é‡ï¼Œä½¿ç”¨æ­¤ç®—æ³•ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
[NaN].incdudes(NaN); // true æ³¨æ„å’ŒindexOfçš„åŒºåˆ«ï¼Œincdudesçš„è¯­ä¹‰æ›´åˆç†

new Set([NaN, NaN]); // [NaN] setä¸­åªä¼šæœ‰ä¸ªä¸€ä¸ªNaNï¼Œå¦‚æœ NaN !== NaNçš„è¯ï¼Œåº”è¯¥æ˜¯[NaN, NaN]

new Map([
  [NaN, 1],
  [NaN, 2],
]); // {NaN => 2} å¦‚æœ NaN !== NaNçš„è¯ï¼Œåº”è¯¥æ˜¯ {NaN => 1, NaN => 2}
```

## å››ã€åŒå€¼

åŒå€¼æ˜¯æœ€åä¸€ç§ç›¸ç­‰ç®—æ³•ï¼Œå…¶å’ŒåŒå€¼é›¶ç±»ä¼¼ï¼Œä½†è®¤ä¸º +0 ä¸ç­‰äº -0ï¼ŒECMAScript 2015 å¸¦æ¥çš„ [Object.is](http://object.is/) ä½¿ç”¨åŒå€¼ç®—æ³•ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
Object.is(NaN, NaN); // true
Object.is(+0, -0); // false ğŸ“¢ æ³¨æ„è¿™é‡Œ
Object.is(0, -0); // false
Object.is(0, +0); // true
Object.is(-0, -0); // true
Object.is(NaN, 0 / 0); // true
Object.is(NaN, NaN); // true
```

å¯¹äºæ•°ç»„åˆ¤æ–­æ˜¯å¦å­˜åœ¨çš„åœºæ™¯ï¼Œå¦‚æœæƒ³åŒºåˆ†+0 å’Œ-0ï¼Œå¯ä»¥ä½¿ç”¨ ECMAScript 2015 å¼•å…¥çš„ find æ–¹æ³•ï¼Œè‡ªè¡Œæ§åˆ¶åˆ¤æ–­é€»è¾‘ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
[0].includes(-0); // ä¸èƒ½åŒºåˆ†-0
[0].find((val) => Object.is(val, -0)); // èƒ½åŒºåˆ†+0å’Œ-0
```

## äº”ã€åŒºåˆ«

ä¸‹é¢å¯¹æ¯”ä¸‹å››ç§ç®—æ³•çš„åŒºåˆ«ï¼ŒåŒºåˆ«å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| éšå¼è½¬æ¢            | NaN å’Œ NaN | +0 å’Œ -0 |
| ------------------- | ---------- | -------- | ----- |
| éä¸¥æ ¼ç›¸ç­‰(\=\=)    | æ˜¯         | false    | true  |
| ä¸¥æ ¼ç›¸ç­‰(\=\=\=)    | å¦         | false    | true  |
| åŒå€¼é›¶(includes ç­‰) | å¦         | true     | true  |
| åŒå€¼(Object.is)     | å¦         | true     | false |

## å…­ã€å¼•ç”¨æ•°æ®ç±»å‹ç›¸ç­‰æ¯”è¾ƒ

### 1. `JSON.stringify(obj)`

```javascript
JSON.stringify(obj) === JSON.stringify(otherObj);
```

è¿™ç§æ–¹æ³•ç®€å•ï¼Œä¸€è¡Œä»£ç å°±æå®šï¼Œä½†æ˜¯æœ‰ç¼ºç‚¹ï¼Œå¦‚ä¸‹ï¼š

- å½“å¯¹è±¡é‡Œ`key`å€¼é¡ºåºä¸ä¸€æ ·æ—¶ï¼Œå°±ä¼šå‡ºé”™
- ä¸€äº›ç‰¹æ®Šç±»å‹çš„å€¼ï¼Œæ¯”å¦‚`undefined`ï¼Œ`Date`ï¼Œ`RegExp`ç­‰ä¼šä¸¢å¤±æˆ–è€…å˜å½¢

### 2. é€’å½’

å®ç°æ€è·¯å¦‚ä¸‹ï¼š

1. å…ˆåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„`key`å€¼çš„é•¿åº¦ã€‚è‹¥é•¿åº¦ä¸ç›¸ç­‰ï¼Œåˆ™ `return false`
2. éå†å¯¹è±¡`obj1`ï¼Œæ£€æŸ¥å¯¹è±¡`obj2`ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„`key`å€¼ï¼Œ æ²¡æœ‰ï¼Œåˆ™`return false`
3. æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¸­è¿™ä¸ª`key`å¯¹åº”çš„å€¼çš„ç±»å‹æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰ï¼Œåˆ™`return false`
4. å¦‚æœå€¼çš„ç±»å‹æ˜¯`undefined`ã€`number`ã€`string`ã€`boolean`çš„ä¸€ç§ï¼Œç›´æ¥ä¸¤ä¸ªå€¼æ¯”è¾ƒï¼Œä¸åŒï¼Œåˆ™`return false`
5. å¦‚æœå€¼æ˜¯`null`ï¼Œé‚£ä¹ˆ æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ã€‚ä¸ç­‰ï¼Œåˆ™`return false`
6. å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œè°ƒç”¨è‡ªèº«
7. å¦‚æœå€¼æ˜¯æ•°ç»„ï¼Œå› ä¸ºæ•°ç»„é¡¹å¯èƒ½æ˜¯ä»»æ„ä¸€ç§æ•°æ®ç±»å‹çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯å…ˆæ¯”è¾ƒé•¿åº¦ï¼Œé•¿åº¦ç›¸ç­‰åå†é€ä¸€æ¯”è¾ƒæ•°ç»„çš„æ¯ä¸€é¡¹ã€‚

æ­¤ä»£ç åŒ…å«äº†å¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ ï¼Œä»£ç å¦‚ä¸‹ï¼š

<iframe height="800" width="100%" scrolling="no" title="Untitled" src="https://codepen.io/aaaaaandy/embed/YzaRMpL?default-tab=html%2Cresult&editable=true" frameborder="no" loading="lazy" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href="https://codepen.io/aaaaaandy/pen/YzaRMpL">
  Untitled</a> by aaaaaAndy (<a href="https://codepen.io/aaaaaandy">@aaaaaandy</a>)
  on <a href="https://codepen.io">CodePen</a>.
</iframe>

```javascript
const NUMBER_TAG = '[object Number]';
const STRING_TAG = '[object String]';
const BOOLEAN_TAG = '[object Boolean]';
const NULL_TAG = '[object Null]';
const UNDEFINED_TAG = '[object Undefined]';
const OBJECT_TAG = '[object Object]';
const ARRAY_TAG = '[object Array]';
const ERROR_TAG = '[object Error]';
const DATE_TAG = '[object Date]';
const REGEXP_TAG = '[object RegExp]';
const MAP_TAG = '[object Map]';
const SET_TAG = '[object Set]';

// ä»¥ä¸‹ä¸¤ç§ç±»å‹ä¸€èˆ¬ä¸æ¯”è¾ƒç›¸ç­‰æ€§
const SYMBOL_TAG = '[object Symbol]';
const FUNCTION_TAG = '[object Function]';

const toString = Object.prototype.toString;
const getKeys = Object.keys;

// mapè½¬æ•°ç»„
function mapToArray(map) {
  let idx = -1;
  const result = new Array(map.size);

  map.forEach(function (value, key) {
    result[++idx] = [key, value];
  });

  return result;
}

// setè½¬æ•°ç»„
function setToArray(set) {
  let idx = -1;
  const result = new Array(set.size);

  set.forEach(function (value) {
    result[++idx] = value;
  });

  return result;
}

/**
 * æ¯”è¾ƒä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰ï¼ŒåŒ…æ‹¬å¼•ç”¨ç±»å‹
 * @param  {[type]} value  [description]
 * @param  {[type]} other  [description]
 * @param  {[type]} vStack [description]
 * @param  {[type]} oStack [description]
 * @return {[type]}        [description]
 */
function eq(value, other, vStack, oStack) {
  const valueType = toString.call(value);
  const otherType = toString.call(other);

  // ç±»å‹ä¸åŒç›´æ¥è¿”å›false
  if (valueType !== otherType) {
    return false;
  }

  // è¿™é‡Œç›´æ¥è¿›è¡Œä¸€ä¸ªç®€å•ç²—æš´çš„åˆ¤æ–­, è¿™é‡Œé»˜è®¤+0ä¸-0ç›¸ç­‰ï¼Œä¸å†è¿›è¡Œå¤„ç†
  // åŒæ ·é€‚ç”¨äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªå¼•ç”¨ä¹Ÿå¯è¿”å›true
  if (value === other) {
    return true;
  }

  // å¤„ç†NaNä¸ç›¸ç­‰æƒ…å†µ
  if (value !== value && other !== other) {
    return true;
  }

  // å¤„ç†å…¶ä»–æƒ…å†µ
  switch (valueType) {
    case NUMBER_TAG:
    case DATE_TAG:
    case BOOLEAN_TAG:
      return +value === +other;
    case STRING_TAG:
    case REGEXP_TAG:
    case NULL_TAG:
    case UNDEFINED_TAG:
      return '' + value === '' + other;
    case ERROR_TAG:
      return value.name === other.name && value.message === other.message;
    case MAP_TAG:
      const valueMapArr = mapToArray(value);
      const otherMapArr = mapToArray(other);

      if (!eq(valueMapArr, otherMapArr, vStack, oStack)) {
        return false;
      }
      break;
    case SET_TAG:
      const valueSetArr = setToArray(value);
      const otherSetArr = setToArray(other);

      if (!eq(valueSetArr, otherSetArr, vStack, oStack)) {
        return false;
      }
      break;
    case ARRAY_TAG:
    case OBJECT_TAG:
      // é¦–å…ˆå¯¹æ¯”æ˜¯å¦ä¸ºå¾ªç¯å¼•ç”¨
      vStack = vStack || [];
      oStack = oStack || [];
      let vStackLength = vStack.length;

      while (vStackLength--) {
        if (vStack[vStackLength] === value && oStack[vStackLength] === other) {
          return true;
        }
      }

      vStack.push(value);
      oStack.push(other);

      // æ•°ç»„å¯¹æ¯”
      if (valueType === ARRAY_TAG) {
        let vLength = value.length;
        let oLength = other.length;

        if (vLength !== oLength) {
          return false;
        }

        while (vLength--) {
          if (!eq(value[vLength], other[vLength], vStack, oStack)) {
            return false;
          }
        }
      }

      // å¯¹è±¡å¯¹æ¯”
      if (valueType === OBJECT_TAG) {
        const vKeys = getKeys(value);
        const oKeys = getKeys(other);
        let vKeysLength = vKeys.length;

        if (vKeys.length !== oKeys.length) {
          return false;
        }

        while (vKeysLength--) {
          // å¯¹è±¡çš„keyé¡ºåºå¯èƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯å¯¹è±¡ä»ç„¶å¯èƒ½ç›¸ç­‰
          if (!oKeys.includes(vKeys[vKeysLength])) {
            return false;
          }

          let currentKey = vKeys[vKeysLength];
          if (!eq(value[currentKey], other[currentKey], vStack, oStack)) {
            return false;
          }
        }
      }
      break;
    default:
      return String(value) === String(other);
  }

  return true;
}
```

## å‚è€ƒæ–‡æ¡£

[JavaScript ä¸­çš„ç›¸ç­‰æ€§åˆ¤æ–­ - JavaScript | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Equality_comparisons_and_sameness) [å¦‚ä½•åœ¨ JavaScript ä¸­åˆ¤æ–­ä¸¤ä¸ªå€¼ç›¸ç­‰](https://yanhaijing.com/javascript/2022/07/10/js-equal/)
