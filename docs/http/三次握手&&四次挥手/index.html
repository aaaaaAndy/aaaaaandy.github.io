<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-http/三次握手&&四次挥手">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">三次握手&amp;&amp;四次挥手 | aaaaaandy.github.io</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aaaaaAndy.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aaaaaAndy.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aaaaaAndy.github.io/docs/http/三次握手&amp;&amp;四次挥手"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="三次握手&amp;&amp;四次挥手 | aaaaaandy.github.io"><meta data-rh="true" name="description" content="TCP并不能保证数据一定会被对方接收到，因为这是不可能的。TCP能够做到的是，如果有可能，就把数据发送到接收方，否则就（通过放弃重传并且中断连接这一手段）通知用户。因此准确说TCP也不是100%可靠的协议，它所能提供的是数据的可靠传递或故障的可靠通知。"><meta data-rh="true" property="og:description" content="TCP并不能保证数据一定会被对方接收到，因为这是不可能的。TCP能够做到的是，如果有可能，就把数据发送到接收方，否则就（通过放弃重传并且中断连接这一手段）通知用户。因此准确说TCP也不是100%可靠的协议，它所能提供的是数据的可靠传递或故障的可靠通知。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aaaaaAndy.github.io/docs/http/三次握手&amp;&amp;四次挥手"><link data-rh="true" rel="alternate" href="https://aaaaaAndy.github.io/docs/http/三次握手&amp;&amp;四次挥手" hreflang="en"><link data-rh="true" rel="alternate" href="https://aaaaaAndy.github.io/docs/http/三次握手&amp;&amp;四次挥手" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="aaaaaandy.github.io RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="aaaaaandy.github.io Atom Feed"><link rel="stylesheet" href="/assets/css/styles.008d67db.css">
<link rel="preload" href="/assets/js/runtime~main.ffc5e5a1.js" as="script">
<link rel="preload" href="/assets/js/main.8fee9b7a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="aaaaaAndy" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="aaaaaAndy" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">aaaaaAndy</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http">HTTP1.0、1.1和2.0的区别</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/CDN是什么，怎么实现">CDN是什么，怎么实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/GET与POST请求的区别">GET与POST请求的区别</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/HTTPS如何保证安全">HTTPS如何保证安全</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/HTTP与HTTPS">HTTP与HTTPS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/HTTP与HTTPS区别">HTTP与HTTPS区别</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/HTTP的请求头都有哪些">HTTP的请求头都有哪些</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/OSI七层模型">OSI七层模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/">README</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/UDP与TCP区别">UDP与TCP区别</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/http各版本之间差异">http各版本之间差异</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/http/三次握手&amp;&amp;四次挥手">三次握手&amp;&amp;四次挥手</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/三次握手和四次挥手">三次握手和四次挥手</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/什么是DNS，什么是DNS查询">什么是DNS，什么是DNS查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/什么是HTTPS，怎么保证安全">什么是HTTPS，怎么保证安全</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/什么是WebSocket，有什么应用场景">什么是WebSocket，有什么应用场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/从输入url到看到页面经历的所有事情">从输入url到看到页面经历的所有事情</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/地址栏输入URL敲下回车后所有动作">地址栏输入URL敲下回车后所有动作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/如何理解TCP、IP协议">如何理解TCP、IP协议</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/常见状态码">常见状态码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/常见的HTTP状态码有哪些">常见的HTTP状态码有哪些</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/常见的HTTP请求方法">常见的HTTP请求方法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/浏览器如何实现断点续传">浏览器如何实现断点续传</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/浏览器缓存机制">浏览器缓存机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/网络OSI模型">网络OSI模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/网络七层结构、五层结构和四层结构">网络七层结构、五层结构和四层结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/http/跨域形成原因以及解决方案">跨域形成原因以及解决方案</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">三次握手&amp;&amp;四次挥手</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>三次握手&amp;&amp;四次挥手</h1></header><p>TCP并不能保证数据一定会被对方接收到，因为这是不可能的。TCP能够做到的是，如果有可能，就把数据发送到接收方，否则就（通过放弃重传并且中断连接这一手段）通知用户。因此准确说TCP也不是100%可靠的协议，它所能提供的是数据的可靠传递或故障的可靠通知。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一三次握手">一、三次握手<a href="#一三次握手" class="hash-link" aria-label="Direct link to 一、三次握手" title="Direct link to 一、三次握手">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-三次握手图解">1. 三次握手图解<a href="#1-三次握手图解" class="hash-link" aria-label="Direct link to 1. 三次握手图解" title="Direct link to 1. 三次握手图解">​</a></h3><p>所谓三次握手(<code>Three-way Handshake</code>)，是指建立一个 TCP 连接时，需要客户端和服务器总共发送3个包。</p><p>三次握手的过程示意图如下：</p><p><img loading="lazy" src="https://raw.githubusercontent.com/aaaaaAndy/picture/main/images/20210129140824.png" alt="tcp-connection-made-three-way-handshake" class="img_ev3q"></p><p>三次握手的目的是连接服务器指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。在 socket 编程中，客户端执行 <code>connect()</code>时。将触发三次握手。</p><ol><li><p>第一次握手(<code>SYN=1, seq=x</code>):</p><p>客户端发送一个 <code>TCP</code> 的 <code>SYN</code> 标志位置<code>1</code>的包，指明客户端打算连接的服务器的端口，以及初始序号 <code>X</code>,保存在包头的序列号(<code>Sequence Number</code>)字段里。 发送完毕后，客户端进入 <code>SYN_SEND</code> 状态。</p></li><li><p>第二次握手(<code>SYN=1, ACK=1, seq=y, ACKnum=x+1</code>):</p><p>服务器发回确认包(<code>ACK</code>)应答。即 <code>SYN</code> 标志位和 <code>ACK</code> 标志位均为<code>1</code>。服务器端选择自己 <code>ISN</code> 序列号，放到 <code>Seq</code> 域里，同时将确认序号(<code>Acknowledgement Number</code>)设置为客户的<code>ISN</code> 加<code>1</code>，即<code>X+1</code>。 发送完毕后，服务器端进入 <code>SYN_RCVD</code> 状态。</p></li><li><p>第三次握手(<code>ACK=1，ACKnum=y+1)</code></p><p>客户端再次发送确认包(<code>ACK</code>)，<code>SYN</code> 标志位为<code>0</code>，<code>ACK</code> 标志位为<code>1</code>，并且把服务器发来 <code>ACK</code> 的序号字段<code>+1</code>，放在确定字段中发送给对方，并且在数据段放写<code>ISN</code>的<code>+1</code></p><p>发送完毕后，客户端进入 <code>ESTABLISHED</code> 状态，当服务器端接收到这个包时，也进入 <code>ESTABLISHED</code> 状态，<code>TCP</code> 握手结束。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-为什么要三次握手">2. 为什么要三次握手<a href="#2-为什么要三次握手" class="hash-link" aria-label="Direct link to 2. 为什么要三次握手" title="Direct link to 2. 为什么要三次握手">​</a></h3><p>客户端和服务端通信前要进行连接，“<strong><em>3次握手</em></strong>”的作用就是 <strong><em>双方都能明确自己和对方的收、发能力是正常的</em></strong>。</p><p><code>第一次握手</code>：客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。</p><p><code>第二次握手</code>：服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。 从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。</p><p><code>第三次握手</code>：客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的。 第一、二次握手后，服务端并不知道客户端的接收能力以及自己的发送能力是否正常。而在第三次握手时，服务端收到了客户端对第二次握手作的回应。从服务端的角度，我在第二次握手时的响应数据发送出去了，客户端接收到了。所以，我的发送能力是正常的。而客户端的接收能力也是正常的。</p><p>经历了上面的三次握手过程，客户端和服务端都确认了自己的接收、发送能力是正常的。之后就可以正常通信了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二四次挥手">二、四次挥手<a href="#二四次挥手" class="hash-link" aria-label="Direct link to 二、四次挥手" title="Direct link to 二、四次挥手">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-四次挥手图解">1. 四次挥手图解<a href="#1-四次挥手图解" class="hash-link" aria-label="Direct link to 1. 四次挥手图解" title="Direct link to 1. 四次挥手图解">​</a></h3><p>四次挥手过程示意图如下：</p><p><img loading="lazy" src="https://raw.githubusercontent.com/aaaaaAndy/picture/main/images/20210129140840.png" alt="tcp-connection-closed-four-way-handshake" class="img_ev3q"></p><p>TCP 的连接的拆除需要发送四个包，因此称为四次挥手(Four-way handshake)，也叫做改进的三次握手。客户端或服务器均可主动发起挥手动作，在 socket 编程中，任何一方执行 <code>close()</code> 操作即可产生挥手操作。</p><ol><li><p>第一次挥手(FIN=1，seq=x)</p><p>假设客户端想要关闭连接，客户端发送一个 FIN 标志位置为1的包，表示自己已经没有数据可以发送了，但是仍然可以接受数据。 发送完毕后，客户端进入 <code>FIN_WAIT_1</code> 状态。</p></li><li><p>第二次挥手(ACK=1，ACKnum=x+1)</p><p>服务器端确认客户端的 FIN 包，发送一个确认包，表明自己接受到了客户端关闭连接的请求，但还没有准备好关闭连接。 发送完毕后，服务器端进入 <code>CLOSE_WAIT</code> 状态，客户端接收到这个确认包之后，进入 <code>FIN_WAIT_2</code> 状态，等待服务器端关闭连接。</p></li><li><p>第三次挥手(FIN=1，seq=y)</p><p>服务器端准备好关闭连接时，向客户端发送结束连接请求，FIN 置为1。 发送完毕后，服务器端进入 <code>LAST_ACK</code> 状态，等待来自客户端的最后一个ACK。</p></li><li><p>第四次挥手(ACK=1，ACKnum=y+1)</p><p>客户端接收到来自服务器端的关闭请求，发送一个确认包，并进入 <code>TIME_WAIT</code>状态，等待可能出现的要求重传的 ACK 包。</p><p>服务器端接收到这个确认包之后，关闭连接，进入 <code>CLOSED</code> 状态。</p><p>客户端等待了某个固定时间（两个最大段生命周期，2MSL，2 Maximum Segment Lifetime）之后，没有收到服务器端的 ACK ，认为服务器端已经正常关闭连接，于是自己也关闭连接，进入 <code>CLOSED</code> 状态。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-为什么要四次挥手">2. 为什么要四次挥手<a href="#2-为什么要四次挥手" class="hash-link" aria-label="Direct link to 2. 为什么要四次挥手" title="Direct link to 2. 为什么要四次挥手">​</a></h3><p>这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方是否现在关闭发送数据通道，需要上层应用来决定，因此，己方ACK和FIN一般都会分开发送。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三syn攻击">三、SYN攻击<a href="#三syn攻击" class="hash-link" aria-label="Direct link to 三、SYN攻击" title="Direct link to 三、SYN攻击">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-什么是syn攻击">1. 什么是SYN攻击<a href="#1-什么是syn攻击" class="hash-link" aria-label="Direct link to 1. 什么是SYN攻击" title="Direct link to 1. 什么是SYN攻击">​</a></h3><p>在三次握手过程中，服务器发送 SYN-ACK 之后，收到客户端的 ACK 之前的 TCP 连接称为半连接(half-open connect)。此时服务器处于 SYN_RCVD 状态。当收到 ACK 后，服务器才能转入 ESTABLISHED 状态.</p><p>SYN 攻击指的是，攻击客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送SYN包，服务器回复确认包，并等待客户的确认。由于源地址是不存在的，服务器需要不断的重发直至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，导致目标系统运行缓慢，严重者会引起网络堵塞甚至系统瘫痪。</p><p>SYN 攻击是一种典型的 DoS/DDoS 攻击。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-如何检测syn攻击">2. 如何检测SYN攻击<a href="#2-如何检测syn攻击" class="hash-link" aria-label="Direct link to 2. 如何检测SYN攻击" title="Direct link to 2. 如何检测SYN攻击">​</a></h3><p>​		检测 SYN 攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击。在 Linux/Unix 上可以使用系统自带的 netstats 命令来检测 SYN 攻击。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-如何防御syn攻击">3. 如何防御SYN攻击<a href="#3-如何防御syn攻击" class="hash-link" aria-label="Direct link to 3. 如何防御SYN攻击" title="Direct link to 3. 如何防御SYN攻击">​</a></h3><p>SYN攻击不能完全被阻止，除非将TCP协议重新设计。我们所做的是尽可能的减轻SYN攻击的危害，常见的防御 SYN 攻击的方法有如下几种：</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-无效连接的监视释放">3.1 无效连接的监视释放<a href="#31-无效连接的监视释放" class="hash-link" aria-label="Direct link to 3.1 无效连接的监视释放" title="Direct link to 3.1 无效连接的监视释放">​</a></h4><p>   监视系统的半开连接和不活动连接，当达到一定阈值时拆除这些连接，从而释放系统资源。这种方法对于所有的连接一视同仁，而且由于SYN Flood造成的半开连接数量很大，正常连接请求也被淹没在其中被这种方式误释放掉，因此这种方法属于入门级的SYN Flood方法。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-延缓tcb分配方法">3.2 延缓TCB分配方法<a href="#32-延缓tcb分配方法" class="hash-link" aria-label="Direct link to 3.2 延缓TCB分配方法" title="Direct link to 3.2 延缓TCB分配方法">​</a></h4><p>   消耗服务器资源主要是因为当SYN数据报文一到达，系统立即分配TCB，从而占用了资源。而SYN Flood由于很难建立起正常连接，因此，当正常连接建立起来后再分配TCB则可以有效地减轻服务器资源的消耗。常见的方法是使用Syn Cache和Syn Cookie技术。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-syn-cache技术">3.3 Syn Cache技术<a href="#33-syn-cache技术" class="hash-link" aria-label="Direct link to 3.3 Syn Cache技术" title="Direct link to 3.3 Syn Cache技术">​</a></h4><p>   系统在收到一个SYN报文时，在一个专用HASH表中保存这种半连接信息，直到收到正确的回应ACK报文再分配TCB。这个开销远小于TCB的开销。当然还需要保存序列号。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="34-syn-cookie技术">3.4 Syn Cookie技术<a href="#34-syn-cookie技术" class="hash-link" aria-label="Direct link to 3.4 Syn Cookie技术" title="Direct link to 3.4 Syn Cookie技术">​</a></h4><p>Syn Cookie技术则完全不使用任何存储资源，这种方法比较巧妙，它使用一种特殊的算法生成Sequence Number，这种算法考虑到了对方的IP、端口、己方IP、端口的固定信息，以及对方无法知道而己方比较固定的一些信息，如MSS(Maximum Segment Size，最大报文段大小，指的是TCP报文的最大数据报长度，其中不包括TCP首部长度。)、时间等，在收到对方 的ACK报文后，重新计算一遍，看其是否与对方回应报文中的（Sequence Number-1）相同，从而决定是否分配TCB资源。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="35-使用syn-proxy防火墙">3.5 使用Syn proxy防火墙<a href="#35-使用syn-proxy防火墙" class="hash-link" aria-label="Direct link to 3.5 使用Syn proxy防火墙" title="Direct link to 3.5 使用Syn proxy防火墙">​</a></h4><p>   一种方式是防止墙dqywb连接的有效性后，防火墙才会向内部服务器发起SYN请求。防火墙代服务器发出的SYN ACK包使用的序列号为c, 而真正的服务器回应的序列号为c&#x27;, 这样，在每个数据报文经过防火墙的时候进行序列号的修改。另一种方式是防火墙确定了连接的安全后，会发出一个safe reset命令，client会进行重新连接，这时出现的syn报文会直接放行。这样不需要修改序列号了。但是，client需要发起两次握手过程，因此建立连接的时间将会延长。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="36-增加最大半连接数">3.6 增加最大半连接数<a href="#36-增加最大半连接数" class="hash-link" aria-label="Direct link to 3.6 增加最大半连接数" title="Direct link to 3.6 增加最大半连接数">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="37-tcp-keeplive">3.7 TCP keeplive<a href="#37-tcp-keeplive" class="hash-link" aria-label="Direct link to 3.7 TCP keeplive" title="Direct link to 3.7 TCP keeplive">​</a></h4><p>TCP 的连接，实际上是一种纯软件层面的概念，在物理层面并没有“连接”这种概念。TCP 通信双方建立交互的连接，但是并不是一直存在数据交互，有些连接会在数据交互完毕后，主动释放连接，而有些不会。在长时间无数据交互的时间段内，交互双方都有可能出现掉电、死机、异常重启等各种意外，当这些意外发生之后，这些 TCP 连接并未来得及正常释放，在软件层面上，连接的另一方并不知道对端的情况，它会一直维护这个连接，长时间的积累会导致非常多的半打开连接，造成端系统资源的消耗和浪费，为了解决这个问题，在传输层可以利用 TCP 的 KeepAlive 机制实现来实现。主流的操作系统基本都在内核里支持了这个特性。</p><p>TCP KeepAlive 的基本原理是，隔一段时间给连接对端发送一个探测包，如果收到对方回应的 ACK，则认为连接还是存活的，在超过一定重试次数之后还是没有收到对方的回应，则丢弃该 TCP 连接。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/http/http各版本之间差异"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">http各版本之间差异</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/http/三次握手和四次挥手"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">三次握手和四次挥手</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一三次握手" class="table-of-contents__link toc-highlight">一、三次握手</a><ul><li><a href="#1-三次握手图解" class="table-of-contents__link toc-highlight">1. 三次握手图解</a></li><li><a href="#2-为什么要三次握手" class="table-of-contents__link toc-highlight">2. 为什么要三次握手</a></li></ul></li><li><a href="#二四次挥手" class="table-of-contents__link toc-highlight">二、四次挥手</a><ul><li><a href="#1-四次挥手图解" class="table-of-contents__link toc-highlight">1. 四次挥手图解</a></li><li><a href="#2-为什么要四次挥手" class="table-of-contents__link toc-highlight">2. 为什么要四次挥手</a></li></ul></li><li><a href="#三syn攻击" class="table-of-contents__link toc-highlight">三、SYN攻击</a><ul><li><a href="#1-什么是syn攻击" class="table-of-contents__link toc-highlight">1. 什么是SYN攻击</a></li><li><a href="#2-如何检测syn攻击" class="table-of-contents__link toc-highlight">2. 如何检测SYN攻击</a></li><li><a href="#3-如何防御syn攻击" class="table-of-contents__link toc-highlight">3. 如何防御SYN攻击</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.ffc5e5a1.js"></script>
<script src="/assets/js/main.8fee9b7a.js"></script>
</body>
</html>