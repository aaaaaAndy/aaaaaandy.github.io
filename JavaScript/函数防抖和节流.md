ğŸ“†: 2019-03-20 15:49:46
ğŸ·: #é˜²æŠ– #èŠ‚æµ
***
## ä¸€ã€æ˜¯ä»€ä¹ˆ

æœ¬è´¨ä¸Šæ˜¯ä¼˜åŒ–é«˜é¢‘ç‡æ‰§è¡Œä»£ç çš„ä¸€ç§æ‰‹æ®µ

å¦‚ï¼šæµè§ˆå™¨çš„ `resize`ã€`scroll`ã€`keypress`ã€`mousemove` ç­‰äº‹ä»¶åœ¨è§¦å‘æ—¶ï¼Œä¼šä¸æ–­åœ°è°ƒç”¨ç»‘å®šåœ¨äº‹ä»¶ä¸Šçš„å›è°ƒå‡½æ•°ï¼Œæå¤§åœ°æµªè´¹èµ„æºï¼Œé™ä½å‰ç«¯æ€§èƒ½

ä¸ºäº†ä¼˜åŒ–ä½“éªŒï¼Œéœ€è¦å¯¹è¿™ç±»äº‹ä»¶è¿›è¡Œè°ƒç”¨æ¬¡æ•°çš„é™åˆ¶ï¼Œå¯¹æ­¤æˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨ **é˜²æŠ–ï¼ˆdebounceï¼‰** å’Œ **èŠ‚æµï¼ˆthrottleï¼‰** çš„æ–¹å¼æ¥å‡å°‘è°ƒç”¨é¢‘ç‡

#### å®šä¹‰
- èŠ‚æµ: n ç§’å†…åªè¿è¡Œä¸€æ¬¡ï¼Œè‹¥åœ¨ n ç§’å†…é‡å¤è§¦å‘ï¼Œåªæœ‰ä¸€æ¬¡ç”Ÿæ•ˆ
- é˜²æŠ–: n ç§’ååœ¨æ‰§è¡Œè¯¥äº‹ä»¶ï¼Œè‹¥åœ¨ n ç§’å†…è¢«é‡å¤è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶

ä¸€ä¸ªç»å…¸çš„æ¯”å–»:

æƒ³è±¡æ¯å¤©ä¸Šç­å¤§å¦åº•ä¸‹çš„ç”µæ¢¯ã€‚æŠŠç”µæ¢¯å®Œæˆä¸€æ¬¡è¿é€ï¼Œç±»æ¯”ä¸ºä¸€æ¬¡å‡½æ•°çš„æ‰§è¡Œå’Œå“åº”

å‡è®¾ç”µæ¢¯æœ‰ä¸¤ç§è¿è¡Œç­–ç•¥ `debounce` å’Œ `throttle`ï¼Œè¶…æ—¶è®¾å®šä¸º15ç§’ï¼Œä¸è€ƒè™‘å®¹é‡é™åˆ¶

ç”µæ¢¯ç¬¬ä¸€ä¸ªäººè¿›æ¥åï¼Œ15ç§’åå‡†æ—¶è¿é€ä¸€æ¬¡ï¼Œè¿™æ˜¯èŠ‚æµ

ç”µæ¢¯ç¬¬ä¸€ä¸ªäººè¿›æ¥åï¼Œç­‰å¾…15ç§’ã€‚å¦‚æœè¿‡ç¨‹ä¸­åˆæœ‰äººè¿›æ¥ï¼Œ15ç§’ç­‰å¾…é‡æ–°è®¡æ—¶ï¼Œç›´åˆ°15ç§’åå¼€å§‹è¿é€ï¼Œè¿™æ˜¯é˜²æŠ–

## äºŒã€å‡½æ•°é˜²æŠ–

åœ¨ç”¨æˆ·æ³¨å†Œæ—¶éªŒè¯ç”¨æˆ·åæ˜¯å¦è¢«å ç”¨ï¼Œå¾ˆå¤šç½‘ç«™ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œä¸å†ç­‰å¾…ç”¨æˆ·ç‚¹å‡»æäº¤æŒ‰é’®æ‰å»æ ¡éªŒè¾“å…¥å†…å®¹ï¼Œè€Œæ˜¯è¾“å…¥æ¡†æœ‰è¾“å…¥å†…å®¹æ—¶å°±æ ¡éªŒã€‚ä½†æ˜¯è¿™æ ·å®ç°ä¼šå¢åŠ æµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæ‰€ä»¥æ­¤æ—¶å‡½æ•°é˜²æŠ–å°±æ´¾ä¸Šç”¨åœºäº†ã€‚å‡½æ•°é˜²æŠ–ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç­‰ä¸€ç³»åˆ—è¾“å…¥æ“ä½œéƒ½å®Œæˆä¹‹åï¼Œä¸€æ®µæ—¶é—´å†…æ²¡æœ‰è¾“å…¥åŠ¨ä½œï¼Œå†å»è¯·æ±‚æœåŠ¡å™¨è¿›è¡Œæ ¡éªŒã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š

### ç®€å•ç‰ˆæœ¬

```javascript
var timer = null;  

// æ­¤å¤„ä¸€å®šè¦æ˜¯å…¨å±€å˜é‡ï¼Œè‡³å°‘ä¸èƒ½åœ¨æ¯æ¬¡è°ƒç”¨debounceçš„æ—¶å€™é‡æ–°å£°æ˜
function debounce(fn, delay) {
	var context = this;
	var args = arguments;

	return function() {
		clearTimeout(timer);

		timer = setTimeout(function() {
			fn.apply(context, args);
		}, delay)
	}
}
```

### ç«‹å³æ‰§è¡Œ

é˜²æŠ–å¦‚æœéœ€è¦ç«‹å³æ‰§è¡Œï¼Œå¯åŠ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ç”¨äºåˆ¤æ–­ï¼Œå®ç°å¦‚ä¸‹ï¼š

```javascript
function debounce(func, wait, immediate) {

    let timeout;

    return function () {
        let context = this;
        let args = arguments;

        if (timeout) clearTimeout(timeout); // timeout ä¸ä¸ºnull
        if (immediate) {
            let callNow = !timeout; // ç¬¬ä¸€æ¬¡ä¼šç«‹å³æ‰§è¡Œï¼Œä»¥ååªæœ‰äº‹ä»¶æ‰§è¡Œåæ‰ä¼šå†æ¬¡è§¦å‘
            timeout = setTimeout(function () {
                timeout = null;
            }, wait)
            if (callNow) {
                func.apply(context, args)
            }
        }
        else {
            timeout = setTimeout(function () {
                func.apply(context, args)
            }, wait);
        }
    }
}
```

## ä¸‰ã€å‡½æ•°èŠ‚æµ

ä»¥åˆ¤æ–­é¡µé¢æ»šåŠ¨æ˜¯å¦åˆ°åº•ä¸ºä¾‹ï¼Œä¸€èˆ¬çš„åšæ³•æ˜¯ç›‘å¬windowçš„scrolläº‹ä»¶ã€‚ä½†æ˜¯é¼ æ ‡æ»šåŠ¨æ˜¯è¿ç»­çš„ï¼Œä¼šè§¦å‘å¤šæ¬¡äº‹ä»¶ï¼Œæ¶ˆè€—æµè§ˆå™¨èµ„æºã€‚æ­¤æ—¶å‡½æ•°èŠ‚æµå°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚å‡½æ•°èŠ‚æµï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å°†è¿ç»­æ‰§è¡Œçš„äº‹ä»¶æ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡ã€‚

å®ŒæˆèŠ‚æµå¯ä»¥ä½¿ç”¨æ—¶é—´æˆ³ä¸å®šæ—¶å™¨çš„å†™æ³•

### å®šæ—¶å™¨å†™æ³•

ä½¿ç”¨å®šæ—¶å™¨å†™æ³•ï¼Œ`delay`æ¯«ç§’åç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œç¬¬äºŒæ¬¡äº‹ä»¶åœæ­¢è§¦å‘åä¾ç„¶ä¼šå†ä¸€æ¬¡æ‰§è¡Œ

```javascript
function throttled2(fn, delay = 500) {
    let timer = null
    return function (...args) {
        if (!timer) {
            timer = setTimeout(() => {
                fn.apply(this, args)
                timer = null
            }, delay);
        }
    }
}
```

### æ—¶é—´æˆ³å†™æ³•

ä½¿ç”¨æ—¶é—´æˆ³å†™æ³•ï¼Œäº‹ä»¶ä¼šç«‹å³æ‰§è¡Œï¼Œåœæ­¢è§¦å‘åæ²¡æœ‰åŠæ³•å†æ¬¡æ‰§è¡Œ

```javascript
function throttled1(fn, delay = 500) {
    let oldtime = Date.now()
    return function (...args) {
        let newtime = Date.now()
        if (newtime - oldtime >= delay) {
            fn.apply(null, args)
            oldtime = Date.now()
        }
    }
}

```

### æ—¶é—´æˆ³ä¸å®šæ—¶å™¨ç»“åˆ

å¯ä»¥å°†æ—¶é—´æˆ³å†™æ³•çš„ç‰¹æ€§ä¸å®šæ—¶å™¨å†™æ³•çš„ç‰¹æ€§ç›¸ç»“åˆï¼Œå®ç°ä¸€ä¸ªæ›´åŠ ç²¾ç¡®çš„èŠ‚æµã€‚å®ç°å¦‚ä¸‹

```javascript
function throttled(fn, delay) {
    let timer = null
    let starttime = Date.now()
    return function () {
        let curTime = Date.now() // å½“å‰æ—¶é—´
        let remaining = delay - (curTime - starttime)  // ä»ä¸Šä¸€æ¬¡åˆ°ç°åœ¨ï¼Œè¿˜å‰©ä¸‹å¤šå°‘å¤šä½™æ—¶é—´
        let context = this
        let args = arguments
        clearTimeout(timer)
        if (remaining <= 0) {
            fn.apply(context, args)
            starttime = Date.now()
        } else {
            timer = setTimeout(fn, remaining);
        }
    }
}
```

## å››ã€åŒºåˆ«

ç›¸åŒç‚¹ï¼š

- éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨ `setTimeout` å®ç°
- ç›®çš„éƒ½æ˜¯ï¼Œé™ä½å›è°ƒæ‰§è¡Œé¢‘ç‡ã€‚èŠ‚çœè®¡ç®—èµ„æº

ä¸åŒç‚¹ï¼š

- å‡½æ•°é˜²æŠ–ï¼Œåœ¨ä¸€æ®µè¿ç»­æ“ä½œç»“æŸåï¼Œå¤„ç†å›è°ƒï¼Œåˆ©ç”¨`clearTimeout `å’Œ `setTimeout`å®ç°ã€‚å‡½æ•°èŠ‚æµï¼Œåœ¨ä¸€æ®µè¿ç»­æ“ä½œä¸­ï¼Œæ¯ä¸€æ®µæ—¶é—´åªæ‰§è¡Œä¸€æ¬¡ï¼Œé¢‘ç‡è¾ƒé«˜çš„äº‹ä»¶ä¸­ä½¿ç”¨æ¥æé«˜æ€§èƒ½
- å‡½æ•°é˜²æŠ–å…³æ³¨ä¸€å®šæ—¶é—´è¿ç»­è§¦å‘çš„äº‹ä»¶ï¼Œåªåœ¨æœ€åæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œå‡½æ•°èŠ‚æµä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡

ä¾‹å¦‚ï¼Œéƒ½è®¾ç½®æ—¶é—´é¢‘ç‡ä¸º500msï¼Œåœ¨2ç§’æ—¶é—´å†…ï¼Œé¢‘ç¹è§¦å‘å‡½æ•°ï¼ŒèŠ‚æµï¼Œæ¯éš” 500ms å°±æ‰§è¡Œä¸€æ¬¡ã€‚é˜²æŠ–ï¼Œåˆ™ä¸ç®¡è°ƒåŠ¨å¤šå°‘æ¬¡æ–¹æ³•ï¼Œåœ¨2såï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

 ![](https://static.vue-js.com/a2c81b50-8787-11eb-ab90-d9ae814b240d.png)


## äº”ã€åº”ç”¨åœºæ™¯

é˜²æŠ–åœ¨è¿ç»­çš„äº‹ä»¶ï¼Œåªéœ€è§¦å‘ä¸€æ¬¡å›è°ƒçš„åœºæ™¯æœ‰ï¼š

- æœç´¢æ¡†æœç´¢è¾“å…¥ã€‚åªéœ€ç”¨æˆ·æœ€åä¸€æ¬¡è¾“å…¥å®Œï¼Œå†å‘é€è¯·æ±‚
- æ‰‹æœºå·ã€é‚®ç®±éªŒè¯è¾“å…¥æ£€æµ‹
- çª—å£å¤§å°`resize`ã€‚åªéœ€çª—å£è°ƒæ•´å®Œæˆåï¼Œè®¡ç®—çª—å£å¤§å°ã€‚é˜²æ­¢é‡å¤æ¸²æŸ“ã€‚

èŠ‚æµåœ¨é—´éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€æ¬¡å›è°ƒçš„åœºæ™¯æœ‰ï¼š

- æ»šåŠ¨åŠ è½½ï¼ŒåŠ è½½æ›´å¤šæˆ–æ»šåˆ°åº•éƒ¨ç›‘å¬
- æœç´¢æ¡†ï¼Œæœç´¢è”æƒ³åŠŸèƒ½
